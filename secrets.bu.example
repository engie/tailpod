variant: fcos
version: 1.6.0

passwd:
  users:
    - name: core
      ssh_authorized_keys:
        - ssh-ed25519 YOUR_PUBLIC_KEY_HERE you@example.com

storage:
  files:
    # Tailscale OAuth credentials for auth key minting
    - path: /etc/tailscale/oauth.env
      mode: 0600
      contents:
        inline: |
          TS_API_CLIENT_ID=your-oauth-client-id
          TS_API_CLIENT_SECRET=your-oauth-client-secret

    # SSH deploy key for container-defs git repo
    - path: /etc/quadlet-deploy/deploy-key
      mode: 0600
      contents:
        inline: |
          -----BEGIN OPENSSH PRIVATE KEY-----
          your-deploy-key-here
          -----END OPENSSH PRIVATE KEY-----

    # Tailscale transform â€” merged into specs in tailscale/ directory
    # Contains tailnet domain in --dns-search (not a credential, but kept out of VCS)
    - path: /etc/quadlet-deploy/transforms/tailscale.container
      mode: 0644
      contents:
        inline: |
          [Unit]
          After=network-online.target

          [Container]
          Network=slirp4netns
          PodmanArgs=--network-cmd-path=/usr/local/bin/ts4nsnet --dns=100.100.100.100 --dns-search=your-tailnet.ts.net

          [Service]
          +ExecStartPre=mkdir -p %t/ts-authkeys
          +ExecStartPre=sudo /usr/local/bin/tailpod-mint-key -config /etc/tailscale/oauth.env -tag tag:tailpod -output %t/ts-authkeys/%N.env -hostname %N
          EnvironmentFile=-%t/ts-authkeys/%N.env
          Restart=on-failure
          RestartSec=10s

          [Install]
          WantedBy=default.target
